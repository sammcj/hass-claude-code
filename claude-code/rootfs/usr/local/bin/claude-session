#!/usr/bin/env bash
set -euo pipefail

# Wrapper script for Claude Code that handles exit gracefully
# - On clean exit (0): terminates session (security)
# - On error: shows message and waits before exit (debugging)

run_claude() {
    local exit_code=0
    claude "$@" || exit_code=$?

    if [[ $exit_code -eq 0 ]]; then
        echo ""
        echo "[Session ended - Claude exited normally]"
        sleep 1
    else
        echo ""
        echo "=========================================="
        echo " Claude exited with code: $exit_code"
        echo "=========================================="
        echo ""
        echo "Common issues:"
        echo "  - Auth expired: run 'claude' to re-authenticate"
        echo "  - Network error: check connectivity"
        echo ""
        echo "Press Enter to close session, or Ctrl+C to stay..."
        read -r || true
    fi

    exit $exit_code
}

run_claude "$@"
